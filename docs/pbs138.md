# PBS 138 of X — Bundling a Web App with Webpack

In the previous instalment we looked at how to use Webpack to bundle a JavaScript library for sharing with the world. This is the Webpack use-case we'll need for the JavaScript port of the `Crypt::HSXKPasswd` Perl module. I'd originally intended to leave the other Webpack use-case, bundling a web app or web site, until later in the series, when we would be re-writing the http://www.xkpasswd.net web app to use our new JavaScript implementation of the password generation module. But, based on the questions I'm being asked, and the personal projects people in the PBS community are working on, I've decided to move the topic forward, so let's go!

## Matching Podcast Episode

TO DO

## Episode Resources

TO UPDATE

* The instalment ZIP file — [pbs138.zip](https://github.com/bartificer/programming-by-stealth/raw/master/instalmentZips/pbs138.zip).

## Why do we need to Bundle Web Apps/Sites?

Up until this point in the series we have imported our dependencies into our web apps using CDNs (content delivery networks) by simply adding appropriate tags into our HTML markup. This has the advantage is being both simple to do and simple to understand — just add the tag, and the browser fetches the latest version from the given URL.

What's wrong with this simple approach?

1. **Version management is difficult** — if we embed a URL for the latest version then we will automatically get upgraded, but we'll have no control over the timing, so our app could just break at any moment. If we embed the URL for a specific version we have to manually check each dependency for new URLs which is cumbersome, so unlikely to happen.
2. **We can't work off-line** — you need an internet connection to load resources from CDNs, so if we go that route we can't work in our code from places without internet access. Those are getting fewer and further between, but still, it would be nice to keep our work self-contained.

## Managing Dependencies with NPM

There are NodeJS packages for all the 3rd-party libraries we've used in this series, so we can use NPM to download copies into our projects and manage their versioning. We can use `npm install` to install the packages we need, `npm outdated` to check for available updates, and `npm upgrade` to apply them.

Once you run `npm install` or `npm ci` all the dependencies will be downloaded, so you won't need network connectivity again until you want to update the dependencies you have, or add more.

At this point the dependencies will be installed in your `node_modules` folder. You could update your HTML to reference the new file paths in `node_modules` with relative URLs, but then to publish your site you'd need to publish your `node_modules` folder to your web server, which is inefficient at best.

## Bundling the Dependencies with Webpack

Similarly to how we converted source code in one folder (`/src`) to bundled code in another (`/dist`) when bundling a library in the previous instalment, we need to write our HTML, CSS & JavaScript in a source folder, and then build bundled versions of the CSS & JavaScript with WebPack, and update our HTML to use the bundle(s).

Once everything is configured the process would be:

1. Edit the code in the source folder (we'll be using `/src`)
2. Build the code using Webpack (we'll configure it to work with `npm run build`)
3. Run the code from the destination folder (we'll be using `/docs` for GitHub Pages compatibility)

To get this to work there are some pre-requisites:

1. Your `package.json` file must specify an entry point by setting the value of the `main` key to the path of your primary JavaScript file, we will be using `src/index.js`.
2. Your entry point must directly or indirectly (by including a file that imports ...) import all your JavaScript & CSS dependencies.
3. You must have Webpack and its needed plugins installed as dev dependencies (`npm install --save-dev webpack webpack-cli css-loader style-loader copy-webpack-plugin`)
4. You need a basic `webpack.config.js` that specifies the entry point, output folder, copies the HTML file(s), and maps CSS files to the appropriate loaders — TO DO — add example
5. Your HTML file(s) need to use relative URLs to import the bundles
6. You need to configure an NPM script named `build` that invokes `webpack` using `npx` — TO DO — add example

## A Worked Example

That sounds more complicated than it is, so it's see how it really works with a somewhat contrived example that uses a good variety of the third-party libraries we've made use of in this series — Bootstrap, jQuery TO DO — update list

You'll find the working code in the `pbs138a` folder in this instalment's ZIP file. This folder is a NodeJS project, so you'll need to open it in a terminal and run `npm ci` to get it ready for use.

LEFT OFF HERE

