# PBS 113 of X ‚Äî My First Git Remote

In [the previous instalment](pbs112) we introduced the concepts and language around *Git Remotes*, and we described some different scenarios for their use. We also introduced the concept of a *bare repository*, one that has all the commits and other data, but no working copy. Bare repositories are generally used as primary or backup copies on some sort of shared medium, with regular repositories used for development work. We also noted that by convention bare repositories are named to end in `.git`.

We also learned that Git Remotes are accessed via URLs, and that there are multiple possible URL schemes for accessing them, but that we would only be using two, local access when the remote is on the same file system as the repository connecting to it, and HTTPS when we're dealing with cloud-hosted remotes.

In this instalment we'll get practical by implementing a relatively real-world scenario. We'll start with a regular copy of the repo we've built up over the past few instalments, and we'll create a bare repository for use as a backup of this repository.

TO REVISIT

## Matching Podcast Episode

TO DO

## Instalment Resources

* The instalment ZIP file ‚Äî [pbs113.zip](https://github.com/bartificer/programming-by-stealth/raw/master/instalmentZips/pbs113.zip).

## Playing Along

If you'd like to play along with the examples you'll need to download this instalment's ZIP file and unzip it. Open a terminal and change to the folder into which you extracted the ZIP . You'll find a bash script named `pbs113-init.sh` in there which will convert the bundle file name `pbs113a.bundle` into a regular repository named `pbs113a`.

This script automates the steps we've been doing manually in the past few instalments:

1. create a folder named `pbs113a`
2. change into that folder
3. initialise it as a Git repo
4. if needed, change the default branch from `master` to `main`
5. import all branches and tags from the bundle

Assuming you have extracted the ZIP file into a folder and opened a terminal in that folder, start by making sure the script is executable:

```
chmod 755 pbs113-init.sh
```

Then simply execute it:

```
./pbs113-init.sh
```

If you view the contents of the folder (in your file manager or on the Terminal with the `ls` command) you'll see that a new folder has been created named `pbs113a`, this is our repository.

## Bonus Extra ‚Äî Echoing Command in a Shell Script

TO DO

## Creating a Bare Repository

The first step to backing our repo up into a new 'remote' repository is to create one. Because we won't be working directly in this repository, it should be bare.

In a real-work scenario you would probably create this bare repository on some kind of shared drive, but we'll keep things simple and simply create it in the folder that contains our init script, bundle file, and primary repository. We'll name our bare repository `pbs113a-backup.git`.

To create our bare repository we first create a folder with the desired name, then we initialise it as a bare Git repository using the `git init` command with the `--bare` flag:

```
mkdir pbs113a-backup.git
git init --bare pbs113a-backup.git
```

## Adding a Remote to an Existing Repository

Let's now enter our primary repository, and add the bare backup repository to it as a remote.

The first step is to change into our repository and check the proverbial lay of the land:

```
bart-imac2018:pbs113 bart% cd pbs113a 
bart-imac2018:pbs113a bart% git status
On branch main
nothing to commit, working tree clean
bart-imac2018:pbs113a bart%
```

As you can see we're on the `main` branch with a clean working tree.

We can also see that this repository has no remotes configured yet by running the `git remote` command without any sub-commands:

```
bart-imac2018:pbs113a bart% git remote
bart-imac2018:pbs113a bart% 
```

Let's use the `add` sub-command of `git remote` to define a new remote with the name `backup` that's linked to our newly created bare repository.

The `git remote add` command takes two arguments, a name for the remote, and the URL to access the remote repository. In this case the remote repository is on the local file system, so we'll use a simple file path as the URL, specifically, we'll use the relative file path `../pbs113a-backup.git` (`..` means *my parent folder* on the terminal).

```
git remote add backup ../pbs113a-backup.git
```

We can now see that the remote exists by invoking `git remote` without any sub-commands or flags:

```
bart-imac2018:pbs113a bart% git remote                                
backup
bart-imac2018:pbs113a bart% 
```

Or, more usefully, we can see the details of the defined remotes by adding the `-v` (for verbose) flag:

```
bart-imac2018:pbs113a bart% git remote -v
backup	../pbs113a-backup.git (fetch)
backup	../pbs113a-backup.git (push)
bart-imac2018:pbs113a bart%
```

## Fetching & Viewing Remote Branches & Tags

For Git to learn the contents of a remote repository, we have to ask it to retrieve the needed information with the `git fetch` command. We can pass the command one or more remote names, or the flag `--all`. Let's fetch the details from our backup repository:

```
git fetch backup
```

We can now list all the remote branches that our repository knows about by passing the `-r` flag to the `git branch` command:

```
git branch -r
```

We get no output because our only remote contains absolutely nothing.

Note that this command lists all **fetched** branches on all configured remotes, it does not read the data from the remote itself. This is why **it's important to fetch before trying to work interact remote branches**.

Viewing remote tags does not work quite as you might expect ‚Äî since you view local branches with `git branch`, and remote branches with `git branch -r`, you might assume that since you view local tags with `git tag` you could view remote tags with `git tag -r`, but alas not üôÅ

The reason for this is very simple ‚Äî remote tags are not fetched by the `git fetch` command, so they can't be read from the local cache. To view remote branches you need to read the data directly from the remote repository.

The command for reading information directly from a remote repository of `git ls-remote`. By default it will list both branches and tags, but you can limit it to just tags with the `--tags` flag.

So, the command to read all branches and tags directly from our `backup` remote is:

```
git ls-remote backup
```

And the command to see just the tags is:

```
git ls-remote --tags backup
```

Again, since our remote repository is completely empty, both of these command return nothing at all.

Put a mental pin in these commands for a moment ‚Äî we'll use them shortly to verify that our backup has been properly initialised.

## Pushing Everything to the Remote

We want our remote to be a full backup of everything in our repository, so we want to send all branches and tags to the remote. We can do this with the `--all` and `--tags` flags and the `git push` command:

First, push all the branches:

```
git push backup --all
```

Then push all the tags:

```
git push backup --tags
```

## Viewing Remote Branches & Tags Revisited

We can verify that we have pushed all the data to our backup using the `git ls-remote` command:

```
bart-imac2018:pbs113a bart% git ls-remote backup
d86b2e36f75ddf958c2a9eddd9868e8ce9f1474b	refs/heads/main
ff8bc623afaabb9c2bcde5bc1bc492dc685a2f3e	refs/tags/v1.0.0
43bca0f7cc7befa88172f217f4d74b3ec58dffc6	refs/tags/v1.1.0
42b42d674716c55d25e4728a0fc8b25823a8e0ed	refs/tags/v2.0.0
4f085d37edf75bb8b157793ccf71d48057a9fe27	refs/tags/v2.1.0
069204cbe50a068c512f152ce37dac9e575c76d5	refs/tags/v2.1.1
8f4e695bd09b458c1c09960cfa73fe37fc853282	refs/tags/v2.2.0
4793fd78939e78f3416e6b966e290651589d817b	refs/tags/v2.3.0
275f564428b0aa21b50ab40a4fd4a674a444f2b3	refs/tags/v2.4.0
b45a1e487e4f7f09480de3e5fb2ee4f21737ecae	refs/tags/v2.4.1
74d6dd0f450097c5c6a792ee8841776cc7f88739	refs/tags/v2.5.0
3e29f1fe0cab9488439bca2c115b012998e45ab3	refs/tags/v2.5.1
b70fb8d6001bbe689786466006f6649242b0c55e	refs/tags/v2.5.2
0df6358fbdc40be7037659fcc5c9db6b6a607cc5	refs/tags/v2.6.0
05970fbccd7583bda297487d3276b9034c000e22	refs/tags/v2.6.1
d86b2e36f75ddf958c2a9eddd9868e8ce9f1474b	refs/tags/v2.7.0
bart-imac2018:pbs113a bart%
```

The output of this command is not as clear as it could be. We've said before that branches are just references to commits which act as the head of a branch, and tags are just references to commits. When you bear that in mind the output begins to make sense.

The first column in the output lists commit hashes, and the second column the thing referencing those commits. Anything starting with `refs/heads/` is a remote branch, and anything starting with `refs/tags/` is a remote tag.

## Pushing Changes to a Remote Branch

We have now succeeded in creating a backup of all our work up to this point, but that's not the end of the story, we now need to update this backup as we create new commits.

LEFT OFF HERE!!!

## Final Thoughts

TO DO